#@opnsense_download_hash:c293d93e45c558bf31ddb04e0e97a3f2
# Emerging Threats Pro
#   http://www.emergingthreatspro.com
#
# This distribution may contain rules under three different licenses.
#
#  Rules with sids 1 through 3464, and 100000000 through 100000908 are under the GPLv2.
#  A copy of that license is available at http://www.gnu.org/licenses/gpl-2.0.html
#
#  Rules with sids 2000000 through 2799999 are from Emerging Threats and are covered under the BSD License
#  as follows:
#
#*************************************************************
#  Copyright (c) 2003-2024, Emerging Threats
#  All rights reserved.
#
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************
#
#
#  Rules with sids 2800000 through 2900000 are provided by Emerging Threats Pro and are covered by the license
#  provided in this distribution titled ETPRO-License.txt
#
#

# This Ruleset is EmergingThreats Pro optimized for suricata-5.0.

alert tcp $EXTERNAL_NET 25 -> $HOME_NET any (msg:"ET SMTP Sorbs.net Block Message"; flow:established,from_server; content:"sorbs.net"; classtype:not-suspicious; sid:2012985; rev:2; metadata:created_at 2011_06_10, updated_at 2019_07_26;)
alert smtp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET SMTP Spamcop.net Block Message"; flow:established,from_server; content:"spamcop.net"; classtype:not-suspicious; sid:2012983; rev:3; metadata:created_at 2011_06_10, updated_at 2019_07_26;)
alert smtp any any -> $HOME_NET any (msg:"ET SMTP Message Containing Windows Performance Analyzer URI In Message Body - Possible NTLM Hash Leak Attempt"; flow:established,to_server; content:"wpa|3a 2f 2f 2f 2f|"; fast_pattern; reference:url,www.varonis.com/blog/outlook-vulnerability-new-ways-to-leak-ntlm-hashes; classtype:credential-theft; sid:2050428; rev:1; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, affected_product Windows_11, attack_target Client_Endpoint, created_at 2024_01_24, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category SMTP, performance_impact Low, confidence High, signature_severity Major, updated_at 2024_01_24; target:dest_ip;)
alert smtp any any -> $HOME_NET any (msg:"ET SMTP Message Containing search-ms URI With subquery Parameter In Message Body - Possible NTLM Hash Leak Attempt"; flow:established,to_server; content:"search-ms|3a 2f 2f|query"; content:"&subquery|3d 5c 5c|"; fast_pattern; within:50; reference:url,www.varonis.com/blog/outlook-vulnerability-new-ways-to-leak-ntlm-hashes; classtype:credential-theft; sid:2050426; rev:1; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, affected_product Windows_11, attack_target Client_Endpoint, created_at 2024_01_24, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category SMTP, performance_impact Low, confidence High, signature_severity Major, updated_at 2024_01_24; target:dest_ip;)
alert smtp any any -> $HOME_NET any (msg:"ET SMTP Message Containing search-ms URI With crumb location Parameter In Message Body - Possible NTLM Hash Leak Attempt"; flow:established,to_server; content:"search-ms|3a 2f 2f|query"; content:"&crumb|3d|location|3a 5c 5c|"; fast_pattern; within:50; reference:url,www.varonis.com/blog/outlook-vulnerability-new-ways-to-leak-ntlm-hashes; classtype:credential-theft; sid:2050427; rev:1; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, affected_product Windows_11, attack_target Client_Endpoint, created_at 2024_01_24, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category SMTP, performance_impact Low, confidence High, signature_severity Major, updated_at 2024_01_24; target:dest_ip;)